syntax = "proto3";

package localmarketingindex.v1;

import "google/protobuf/timestamp.proto";
import "google/api/annotations.proto";

enum Category {
    LISTINGS = 0;
    REPUTATION = 1;
    SOCIAL = 2;
    WEBSITE = 3;
    SEO = 4;
    ADVERTISING = 5;
    CONTENT_AND_EXPERIENCE = 6;
}

enum LetterGrade {
    A = 0;
    B = 1;
    C = 2;
    D = 3;
    F = 4;
}

message Grade {
    string account_group_id = 1;
    LetterGrade letter_grade = 2;
    Category category = 3;
    google.protobuf.Timestamp updated = 4;
    string source = 5;
}

// Relevant percentiles for computing letter grades and industry stats
message Percentiles {
    float ninety_fifth = 1;
    float eightieth = 2;
    float fiftieth = 3;
    float twentieth = 4;
    float tenth = 5;
}

// A model definition for industry stats average and relevant percentiles
message IndustryStats {
    float average = 1;
    Percentiles percentiles = 2;
}

// A model definition for historical score data and required time format
message HistoricalScoreDataPoint {
    // The listing score
    int64 score = 1;
    // The timestamp for listing score
    google.protobuf.Timestamp timestamp = 2;
}

// *******************
// Requests
// *******************
message GetGradeRequest {
    string account_group_id = 1;
    Category category = 2;
}

message GetGradeMultiRequest {
    repeated string account_group_ids = 1;
    Category category = 2;
}

message GetScoreRequest {
    string account_group_id = 1;
    Category category = 2;
}

message CreateGradeRequest {
    string account_group_id = 1;
    Category category = 2;
    LetterGrade letter_grade = 3;
    string source = 4;
}

// A request for getting the industry stats for a taxonomy
message GetIndustryStatsRequest {
    // The unique identifier for the category
    Category category = 1;
    // The unique identifier of the taxonomy.
    string taxonomy_id = 2;
    // The unique identifier of the country.
    string country = 3;
    // The unique identifier of the state.
    string state = 4;
    // The unique identifier of the city.
    string city = 5;
}

// A request for getting the regional grades for an account
message GetRegionalGradesRequest {
    // The unique identifier for the account group
    string account_group_id = 1;
    // The unique identifier for the category
    Category category = 2;
}

// A request for getting the historical score for an account
message GetHistoricalScoreDataRequest {
    // The unique identifier for the account group
    string account_group_id = 1;
    // The unique identifier for the category
    Category category = 2;
}

// A request for getting the listing presence data for an account
message GetListingPresenceRequest {
    // The unique identifier of the account group.
    string account_group_id = 1;
}

// A request for getting the listing accuray data for an account
message GetListingAccuracyRequest {
    // The unique identifier of the account group.
    string account_group_id = 1;
}

// *******************
// Responses
// *******************
message GetGradeResponse {
    Grade grade = 1;
}

message GetGradeMultiResponse {
    message GradeContainer {
        Grade grade = 1;
    }
    repeated GradeContainer grades = 1;
}

message GetScoreResponse {
    int64 score = 1;
}

message CreateGradeResponse {
    Grade grade = 1;
}

// A response containing the industry stats for a taxonomy
message GetIndustryStatsResponse {
    // The industry stats based on world
    IndustryStats world = 1;
    // The industry stats based on country
    IndustryStats country = 2;
    // The industry stats based on state
    IndustryStats state = 3;
    // The industry stats based on city
    IndustryStats city = 4;
}

// A response containing the regional grades for an account
message GetRegionalGradesResponse {
    // The letter grade based on the country
    LetterGrade country = 1;
    // The letter grade based on the state
    LetterGrade state = 2;
    // The letter grade based on the city
    LetterGrade city = 3;
    // The letter grade based on the world
    LetterGrade world = 4;
    // The last updated timestamp for the account
    google.protobuf.Timestamp updated = 5;
}

// A response containing the historical listing score for an account
message GetHistoricalScoreDataResponse {
    // The historical listing score of the account group.
    repeated HistoricalScoreDataPoint historical_score_data = 1;
}

// A response containing the listing presence values for an account
message GetListingPresenceResponse {
    // The actual listing count for that account
    int64 listing_count = 1;
    //The average listing count for all accounts under same taxonomy category
    float world_average = 2;
    //The average listing count for all accounts under same taxonomy category and same country
    float country_average = 3;
    //The average listing count for all accounts under same taxonomy category and same state
    float state_average = 4;
    //The average listing count for all accounts under same taxonomy category and same city
    float city_average = 5;
}

// A response containing the listing accuracy values for an account
message GetListingAccuracyResponse {
    // The actual listing accuracy for that account
    float listing_accuracy = 1;
    //The average listing accuracy for all accounts under same taxonomy category
    float world_average = 2;
    //The average listing accuracy for all accounts under same taxonomy category and same country
    float country_average = 3;
    //The average listing accuracy for all accounts under same taxonomy category and same state
    float state_average = 4;
    //The average listing accuracy for all accounts under same taxonomy category and same city
    float city_average = 5;
}

// Service for Local Marketing Index
service LocalMarketingIndex {
    // Get a lmi category grade for an account
    rpc GetGrade (GetGradeRequest) returns (GetGradeResponse) {
        option (google.api.http) = {
            post: "/v1/grades/get"
            body: "*"
        };
    };
    // Get a set of lmi category grades for a set of accounts
    rpc GetGradeMulti (GetGradeMultiRequest) returns (GetGradeMultiResponse) {};

    // Create a lmi category grade for an account
    rpc CreateGrade (CreateGradeRequest) returns (CreateGradeResponse) {
        option (google.api.http) = {
            post: "/v1/grades/create"
            body: "*"
        };
    };
    // Get a lmi category score for an account
    rpc GetScore (GetScoreRequest) returns (GetScoreResponse) {
        option (google.api.http) = {
            post: "/v1/scores/get"
            body: "*"
        };
    };
    // Get the industry stats based on taxonomy
    rpc GetIndustryStats (GetIndustryStatsRequest) returns (GetIndustryStatsResponse) {
        option (google.api.http) = {
            post: "/v1/industry-stats/get"
            body: "*"
        };
    };
    // Get regional grades for an account
    rpc GetRegionalGrades (GetRegionalGradesRequest) returns (GetRegionalGradesResponse) {
        option (google.api.http) = {
            post: "/v1/grades/regional/get"
            body: "*"
        };
    };
    // Get the historical listing score for an account
    rpc GetHistoricalScoreData (GetHistoricalScoreDataRequest) returns (GetHistoricalScoreDataResponse) {
        option (google.api.http) = {
            post: "/v1/scores/historical/get"
            body: "*"
        };
    };
    // Get the listing presence data for an account
    rpc GetListingPresence (GetListingPresenceRequest) returns (GetListingPresenceResponse) {};
    // Get the listing accuracy data for an account
    rpc GetListingAccuracy (GetListingAccuracyRequest) returns (GetListingAccuracyResponse) {};
}
